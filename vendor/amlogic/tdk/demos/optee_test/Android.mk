LOCAL_PATH := $(call my-dir)
TEE_XTEST_PATH := $(PRODUCT_OUT)/gen/EXECUTABLES/tee_xtest_intermediates

$(info $(shell if [ ! -d $(TEE_XTEST_PATH) ]; then mkdir -p $(TEE_XTEST_PATH); fi))

CFG_TEEC_PUBLIC_PATH = $(LOCAL_PATH)/../../ca_export_$(TARGET_ARCH)

CFG_TA_DEV_KIT_DIR = $(LOCAL_PATH)/../../ta_export

include $(CFG_TA_DEV_KIT_DIR)/host_include/conf.mk

include $(CLEAR_VARS)
LOCAL_MODULE := tee_xtest
LOCAL_SHARED_LIBRARIES := libteec

ifeq ($(shell test $(PLATFORM_SDK_VERSION) -ge 26 && echo OK),OK)
LOCAL_PROPRIETARY_MODULE := true
endif

srcs := regression_1000.c

ifeq ($(CFG_GP_SOCKETS),y)
srcs += regression_2000.c \
	sock_server.c \
	rand_stream.c
endif

srcs +=	adbg/src/adbg_case.c \
	adbg/src/adbg_enum.c \
	adbg/src/adbg_expect.c \
	adbg/src/adbg_log.c \
	adbg/src/adbg_run.c \
	adbg/src/security_utils_hex.c \
	aes_perf.c \
	benchmark_1000.c \
	benchmark_2000.c \
	regression_4000.c \
	regression_5000.c \
	regression_6000.c \
	regression_7000.c \
	regression_8000.c \
	regression_9000.c \
	sha_perf.c \
	xtest_helpers.c \
	xtest_main.c \
	xtest_test.c

ifeq ($(CFG_SECURE_DATA_PATH),y)
srcs += sdp_basic.c
endif

LOCAL_SRC_FILES := $(patsubst %,host/xtest/%,$(srcs))
LOCAL_C_INCLUDES += $(CFG_TEEC_PUBLIC_PATH)/include \
					$(CFG_TA_DEV_KIT_DIR)/host_include

LOCAL_C_INCLUDES += $(LOCAL_PATH)/host/xtest \
		$(LOCAL_PATH)/host/xtest/adbg/include\
		$(LOCAL_PATH)/host/xtest/xml/include \
		$(TA_DEV_KIT_DIR)/host_include \
		$(LOCAL_PATH)/ta/concurrent/include \
		$(LOCAL_PATH)/ta/concurrent_large/include \
		$(LOCAL_PATH)/ta/create_fail_test/include \
		$(LOCAL_PATH)/ta/crypt/include \
		$(LOCAL_PATH)/ta/enc_fs/include \
		$(LOCAL_PATH)/ta/os_test/include \
		$(LOCAL_PATH)/ta/rpc_test/include \
		$(LOCAL_PATH)/ta/sims/include \
		$(LOCAL_PATH)/ta/storage/include \
		$(LOCAL_PATH)/ta/storage_benchmark/include \
		$(LOCAL_PATH)/ta/sha_perf/include \
		$(LOCAL_PATH)/ta/aes_perf/include \
		$(LOCAL_PATH)/ta/socket/include \
		$(LOCAL_PATH)/ta/sdp_basic/include

# Include configuration file generated by OP-TEE OS (CFG_* macros)
LOCAL_CFLAGS += -include $(CFG_TA_DEV_KIT_DIR)/host_include/conf.h
LOCAL_CFLAGS += -DTA_DIR=\"/system/lib/teetz\"
LOCAL_CFLAGS += -pthread
LOCAL_CFLAGS += -g3

include $(BUILD_EXECUTABLE)

include $(LOCAL_PATH)/ta/Android.mk
